FROM debian:buster

RUN apt-get update \
	&& apt-get install -y --no-install-recommends \
		curl \
		php \
		php-json \
		php-mysqli \
		php-curl \
		php-dom \
		php-exif \
		php-fileinfo \
		php-imagick \
		php-mbstring \
		php-xml \
		php-zip \
		php-fpm \
	&& rm -rf /var/lib/apt/lists/*

WORKDIR /var/www/html

RUN curl -o wordpress.tar.gz -kL https://wordpress.org/wordpress-6.2.tar.gz \
	&& tar -xzf wordpress.tar.gz \
	&& mv wordpress/* . \
	&& rm -rf wordpress wordpress.tar.gz

COPY conf/wp-config.php .
COPY conf/www.conf /etc/php/7.3/fpm/pool.d

RUN mkdir -p /var/run/php \
	&& chown -R www-data:www-data /var/www/html /var/run/php \
	&& chmod 777 /var/run/php

VOLUME /var/www/html

EXPOSE 9000

CMD ["/usr/sbin/php-fpm7.3", "-F"]
